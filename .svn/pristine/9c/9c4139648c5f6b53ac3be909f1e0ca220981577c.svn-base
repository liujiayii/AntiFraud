package com.antifraud.controller;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.Map;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;

import com.alibaba.fastjson.JSONArray;
import com.alibaba.fastjson.JSONObject;
import com.antifraud.utils.AcceptUntils;


@Controller
@RequestMapping("AcceptController")
public class AcceptController {
           
	
	@RequestMapping("Accept")
	@ResponseBody
	public static Object loadJson(int page,int limit) {
			
		
		Map<Object, Object> map = new HashMap<>();
		
	    ArrayList<Object> arrayList = new ArrayList<>(); 
		
	    JSONArray jsonArray = new JSONArray();
	    String loadJson = null;
	    try {
	    	loadJson = AcceptUntils.loadJson("http://192.168.1.105:8005/loanTrack");
		} catch (Exception e) {
			  map.put("code", -1);
		       map.put("msg", "数据获取异常");
		       map.put("data", arrayList);
			   map.put("count", 0);
		       
			   return JSONObject.toJSON(map);
		}
		
		
		
		loadJson =loadJson.substring(loadJson.indexOf("["), loadJson.lastIndexOf("]")+1);
		//System.out.println(loadJson);
		JSONArray json = (JSONArray) JSONArray.parse(loadJson);
		
		try {
			int star =(page - 1) * limit;
		       for (int i = star; i < star + limit; i++) {
		    	   arrayList.add(json.get(i));
			   }
		} catch (Exception e) {
			// TODO: handle exception
		}		
		
       map.put("code", 1);
       map.put("msg", "查询成功");
       map.put("data", arrayList);
	   map.put("count", json.size());
       
	   return JSONObject.toJSON(map);
	}
	
	
}
