package com.antifraud.controller;

import java.io.BufferedReader;
import java.io.File;
import java.io.FileInputStream;
import java.io.InputStreamReader;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.apache.commons.lang.StringUtils;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;

import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.JSONArray;
import com.alibaba.fastjson.JSONObject;
import com.antifraud.utils.AcceptUntils;
import com.antifraud.utils.HttpClientUtil;
import com.antifraud.utils.JsonUtil;

/**
 * 贷后管理
 *
 * @ClassName: AcceptController

 * @description 
 *
 * @author lisaozhang
 * @createDate 2018年12月17日-上午11:23:02
 */
@Controller
@RequestMapping("AcceptController")
public class AcceptController {
           
	
	@RequestMapping("Accept")
	@ResponseBody
	public static Object loadJson(int page,int limit) {
			
		
		Map<Object, Object> map = new HashMap<>();
		
	    ArrayList<Object> arrayList = new ArrayList<>(); 
		
	    JSONArray jsonArray = new JSONArray();
	    String loadJson = null;
	    try {
	    	loadJson = AcceptUntils.loadJson("http://192.168.1.102:8001/loanTrack");
		} catch (Exception e) {
			  map.put("code", -1);
		       map.put("msg", "数据获取异常");
		       map.put("data", arrayList);
			   map.put("count", 0);
		       
			   return JSONObject.toJSON(map);
		}
		
		
		
		loadJson =loadJson.substring(loadJson.indexOf("["), loadJson.lastIndexOf("]")+1);
		//System.out.println(loadJson);
		JSONArray json = (JSONArray) JSONArray.parse(loadJson);
		
		try {
			int star =(page - 1) * limit;
		       for (int i = star; i < star + limit; i++) {
		    	   arrayList.add(json.get(i));
			   }
		} catch (Exception e) {
			// TODO: handle exception
		}		
		
       map.put("code", 1);
       map.put("msg", "查询成功");
       map.put("data", arrayList);
	   map.put("count", json.size());
       
	   return JSONObject.toJSON(map);
	}
	
	/**
	 * 通过电话查询
	 *
	 * @Title: findByPhone
	
	 * @description 
	 *
	 * @param phone 电话
	 * @param @return 
	   
	 * @return String    
	 *
	 * @author lujinpeng
	 * @createDate 2018年12月17日-下午3:12:14
	 */
	/*@RequestMapping("findByPhone")
	@ResponseBody
	public String findByPhone (String phone) {
		int code = 1, count = 0;
		String msg = "成功";
		
		*//** 电话号码 *//*
		String mobile = "";
		*//** 获取到的数据 *//*
		String loadJson = null;
		List<Object> list = new ArrayList<>();
		try {
	    	loadJson = AcceptUntils.loadJson("http://192.168.1.102:8001/loanTrack");
		} catch (Exception e) {
			code = -1;
			msg = "系统异常";
		}
		
		JSONObject obj = JSON.parseObject(loadJson);
		JSONArray array = obj.getJSONObject("pageOfBills").getJSONArray("page");
		
		if (StringUtils.isEmpty(phone.trim())) {
			list = JSONArray.parseArray(array.toJSONString(), Object.class);
		} else {
			for (int i = 0; i < array.size(); i++) {
				mobile = array.getJSONObject(i).getString("mobile");
				if (mobile.contains(phone.trim())) {
					list.add(array.getJSONObject(i));
				}
			}
		}
		
		count = list.size();
		if (count == 0) {
			msg = "无数据";
		}
	
		return JsonUtil.getResponseJson(code, msg, count, list);
	}*/
	
	/**
	 * 通过电话查询
	 *
	 * @Title: findByPhone
	
	 * @description 
	 *
	 * @param @param phone
	 * @param @return 
	   
	 * @return String    
	 *
	 * @author lujinpeng
	 * @createDate 2018年12月17日-下午5:51:55
	 */
	@RequestMapping("findByPhone")
	@ResponseBody
	public String findByPhone (String phone) {
		int code = 1;
		String msg = "成功";
		int count = 0;
		String data = null;
		try {
			data = HttpClientUtil.doGet("http://192.168.1.102:8001/loanMobile?mobile=" + phone);
			JSONObject obj = JSON.parseObject(data);
			JSONArray array = obj.getJSONArray("pagemobile");
			count = array.size();
		} catch (Exception e) {
			e.printStackTrace();
			code = -1;
			msg = "系统异常";
		}
		
		return JsonUtil.getResponseJson(code, msg, count, data);
	}
}
